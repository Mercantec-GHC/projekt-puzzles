@page "/sign-up"
@rendermode InteractiveServer
@using Blazor.Components.Shared
@inject UserService userService
@inject NavigationManager NavigationManager

<PageTitle>Sign up</PageTitle>


<section>
    <div>

    <h1>Sign up</h1>
    <EditForm Model="@loginUser" OnValidSubmit="@Submit" FormName="SignUpForm">
        <label>
            Username
            <InputText @bind-Value="loginUser.Username" required />
        </label>
        
        <label>
            Password
            <InputText @bind-Value="loginUser.Password" type="password" required />
        </label>
        <label>
            Confirm password
            <InputText @bind-Value="passwordCopy" type="password" required />
        </label>
        <label>
            Email
            <InputText @bind-Value="loginUser.Email" type="email" required />
        </label>
        <label>
            Phone number
            <InputText @bind-Value="loginUser.PhoneNumber" type="tel" />
        </label>
        <br />
        <button type="submit">Sign up</button>
    </EditForm>

        @if (message != null)
        {
        <p>@message</p>    
        }
    </div>
</section>


@code {
    User loginUser = new();
    string passwordCopy = "";
    string message = "";



    /// <summary>
    /// Handles the sign-up form submission.
    /// Checks if the password and confirmation match, then creates the user and navigates to the login page.
    /// Otherwise, displays an error message.
    /// </summary>
    private async Task Submit()
    {
        // Check if the password and confirmation match
        if (loginUser.Password == passwordCopy)
        {
            // Create the user account
            await userService.CreateUserAsync(loginUser);
            // Optionally display a message, then navigate to login
            //message = "your account has been submitted";
            NavigationManager.NavigateTo("/login");
        }
        else
        {
            // Show an error if the passwords do not match
            message = "The passwords does not match";
        }
    }
}