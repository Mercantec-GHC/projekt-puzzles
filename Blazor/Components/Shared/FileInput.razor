@using System.Reflection.Metadata
<div class="form-group file-input">
    <div class="form-group-contents">
        <label>
            @(Label ?? "File")
            <InputFile OnChange="@OnFileChange" accept="image/jpeg" required="@required" />
        </label>
        <InputHidden @bind-Value="fileName" required="@required" />
        <button class="warning" type="button" @onclick="ClearFile">Clear @(Label ?? "File")</button>
    </div>
    @if (fileName != null) {
        <div class="form-group-contents selected-file">
            @fileName
        </div>
    }
</div>


@code {

    /// <summary>
    /// Event callback triggered when a file is selected by the user.
    /// </summary>
    [Parameter]
    public EventCallback<InputFileChangeEventArgs> OnChange { get; set; }

    /// <summary>
    /// Event callback triggered when the file input is cleared.
    /// </summary>
    [Parameter]
    public EventCallback<InputFileChangeEventArgs> OnClear { get; set; }

    /// <summary>
    /// Indicates whether selecting a file is required.
    /// </summary>
    [Parameter]
    public bool required { get; set; } = false;

    /// <summary>
    /// Handles the file selection event, updates the fileName, and invokes the OnChange callback.
    /// </summary>
    /// <param name="e">The file change event arguments.</param>
    private async Task OnFileChange(InputFileChangeEventArgs e)
    {
        // Store the selected file's name for display and binding
        fileName = e.File.Name;
        // Notify parent component or handler of the file change
        await OnChange.InvokeAsync(e);
    }

    /// <summary>
    /// Clears the selected file and invokes the OnClear callback.
    /// </summary>
    private void ClearFile()
    {
        // Remove the file name from the input
        fileName = null;
        // Notify parent component or handler that the file was cleared
        OnClear.InvokeAsync();
    }



    [Parameter]
    public string? Label { get; set; }

    private string? fileName;
}